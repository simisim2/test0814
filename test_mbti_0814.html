<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MBTI 진단 | 파스텔 톤 단일 파일</title>
  <style>
    :root{
      --bg: #f8fbff;
      --text: #2b2d33;
      --muted: #6b7280;
      --card: #ffffffcc;
      --accent-1: #b8e0d2; /* 민트 */
      --accent-2: #ffd3b6; /* 피치 */
      --accent-3: #e3d7ff; /* 라일락 */
      --accent-4: #ffe6f0; /* 로즈 */
      --primary: #7cc6b2;
      --shadow: 0 10px 30px rgba(17, 24, 39, 0.12);
      --radius: 20px;
      --radius-sm: 12px;
      --focus: 0 0 0 3px rgba(124,198,178,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial, "Apple SD Gothic Neo", "Malgun Gothic", "맑은 고딕", sans-serif;
      color:var(--text);
      background: linear-gradient(140deg, var(--accent-1), var(--accent-3) 45%, var(--accent-2));
      background-attachment: fixed;
    }
    header{
      padding: 28px 16px 8px;
      text-align:center;
    }
    .title{
      display:inline-block;
      font-weight:800;
      letter-spacing:-0.4px;
      font-size: clamp(22px, 3.5vw, 34px);
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffffffaa, #ffffff88);
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }
    main{padding: 12px}
    .container{
      max-width: 1000px;
      margin: 16px auto 48px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .banner{
      padding: 28px 28px 10px;
      display:flex;
      flex-wrap:wrap;
      gap: 16px;
      align-items:center;
      justify-content:space-between;
    }
    .banner .desc{color:#111827; opacity:.9}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      background: #fff;
      color:#0f766e;
      border-radius: 999px;
      padding: 6px 12px;
      font-weight:600;
      box-shadow: var(--shadow);
    }
    .progress-wrap{padding: 12px 22px 22px}
    .progress{
      width:100%; height: 10px; border-radius: 999px; background:#e5e7eb;
      overflow:hidden;
    }
    .progress > div{height:100%; width:0; background: linear-gradient(90deg, #7cc6b2, #86a8e7); transition: width .35s ease}

    .section{padding: 0 24px 24px}
    .card{
      background:#fff;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .q-grid{display:grid; gap:16px}
    @media(min-width:720px){.q-grid{grid-template-columns:1fr 1fr}}

    fieldset{border:0; padding:0; margin:0}
    .q{
      display:flex; flex-direction:column; gap:14px;
      border:1px solid #eef2f7;
      border-radius: 16px; padding:16px; background: linear-gradient(180deg,#ffffff, #fbfdff);
    }
    .q .meta{font-size:12px; color:var(--muted)}
    .q .stem{font-weight:700}
    .scale{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:8px; align-items:center;
    }
    .anchors{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
    .options{
      display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap;
    }
    .pill{
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      width:34px; height:34px; border-radius:999px; background:#f3f4f6; cursor:pointer;
      transition: transform .12s ease, background .2s ease;
    }
    .pill input{position:absolute; opacity:0; pointer-events:none}
    .pill:hover{transform: translateY(-1px)}
    .pill[data-checked="true"]{background: #c7f0e5; box-shadow: inset 0 0 0 2px #7cc6b2}
    .controls{
      display:flex; gap:12px; padding: 20px; justify-content:space-between; align-items:center; flex-wrap:wrap
    }
    button{
      border:0; border-radius: 999px; padding: 12px 18px; font-weight:700; cursor:pointer;
      background: linear-gradient(90deg, #7cc6b2, #86a8e7);
      color:#fff; box-shadow: var(--shadow);
    }
    button.secondary{background:#fff; color:#0f172a; box-shadow: inset 0 0 0 2px #cbd5e1}
    button:focus{outline:none; box-shadow: var(--focus)}

    .hidden{display:none}

    /* 결과 섹션 */
    .result{
      display:grid; gap:18px; padding: 10px 24px 32px;
      grid-template-columns: 1fr; align-items:start;
    }
    @media(min-width:900px){
      .result{grid-template-columns: 1.2fr .8fr}
    }
    .type-chip{font-size: clamp(28px, 6vw, 44px); font-weight:900; letter-spacing:-1px}
    .type-chip small{font-size: clamp(12px, 2.2vw, 16px); color:var(--muted); font-weight:600}
    .bars{display:grid; gap:10px}
    .bar{background:#f1f5f9; border-radius:12px; overflow:hidden}
    .bar > div{height:18px; width:50%; background: linear-gradient(90deg, #ffd3b6, #e3d7ff)}
    .bar-label{display:flex; justify-content:space-between; font-size:12px; color:var(--muted); margin: 4px 2px}

    .note{font-size:12px; color:var(--muted)}
    .list{display:grid; gap:10px}
    .list li{background:#fff; border-radius:12px; padding:12px; border:1px solid #eef2f7}

    footer{padding:26px; text-align:center; color:#172554; font-size:12px}

    .fade-in{animation: fade .35s ease both}
    @keyframes fade{from{opacity:0; transform: translateY(6px)} to{opacity:1; transform:none}}
  </style>
</head>
<body>
  <header>
    <div class="title">파스텔 톤 MBTI 진단</div>
  </header>

  <main>
    <div class="container">
      <div class="banner">
        <div class="desc">
          <h2 style="margin:0 0 6px 0">선호 성향을 알아보고, 소통 전략에 활용하세요</h2>
          <div class="note">정답/오답이 아닌 <b>편한 사용 습관</b>을 측정합니다. 총 24문항 · 약 5~7분</div>
        </div>
        <div class="badge" aria-live="polite">Step-by-step · 중간저장 없이 간단 진행</div>
      </div>

      <div class="progress-wrap">
        <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>
      </div>

      <!-- Intro -->
      <section id="intro" class="section fade-in">
        <div class="card" role="region" aria-label="설명">
          <p>각 문항은 7점 척도입니다. 왼쪽 진술에 더 동의하면 낮은 점수(1~3), 가운데면 4, 오른쪽 진술에 더 동의하면 높은 점수(5~7)를 선택하세요.</p>
          <ul class="list" style="margin:12px 0 0">
            <li>검사 결과는 채용/평가의 근거가 아닌 <b>대화의 시작점</b>입니다.</li>
            <li>한 유형에 <b>고정</b>되지 않으며, 맥락/경험에 따라 표현이 달라질 수 있어요.</li>
            <li>결과 화면에서 4축의 <b>선호 강도(%)</b>와 16유형 설명을 제공합니다.</li>
          </ul>
          <div class="controls">
            <span class="note">준비되셨다면 시작하세요.</span>
            <div style="display:flex; gap:10px">
              <button id="startBtn" aria-label="검사 시작">시작하기</button>
              <button class="secondary" id="skipToDemo" aria-label="데모 보기">데모 결과 보기</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Quiz -->
      <section id="quiz" class="section hidden" aria-live="polite">
        <form id="quizForm" class="q-grid"></form>
        <div class="controls">
          <div class="note"><span id="currentPage">1</span> / <span id="totalPages">1</span> 페이지</div>
          <div style="display:flex; gap:10px; align-items:center">
            <button type="button" class="secondary" id="prevBtn" disabled>이전</button>
            <button type="button" id="nextBtn">다음</button>
            <button type="button" id="submitBtn" class="hidden">결과보기</button>
          </div>
        </div>
      </section>

      <!-- Result -->
      <section id="result" class="section hidden">
        <div class="result">
          <div class="card">
            <div class="type-chip" id="typeCode">—<small id="typeName"></small></div>
            <p id="typeSummary" style="margin-top:6px"></p>
            <div class="bars" id="bars"></div>
            <p class="note">선호 강도는 각 축에서 중립(4)을 기준으로 얼마나 치우쳤는지를 0–100%로 환산한 값입니다.</p>
            <div class="controls" style="padding-left:0">
              <button id="shareBtn" type="button" aria-label="결과 링크 복사">결과 공유 링크 복사</button>
              <button id="restartBtn" type="button" class="secondary" aria-label="다시 시작">다시 시작</button>
            </div>
          </div>
          <div class="card">
            <h3 style="margin-top:0">유형 설명 & 활용 팁</h3>
            <ul class="list" id="tips"></ul>
          </div>
        </div>
      </section>
    </div>
  </main>
  <footer>© 2025 Pastel MBTI • 교육·코칭 참고용</footer>

  <script>
    // ====== 데이터: 문항 (24문항, 축당 6개) ======
    // 각 문항: { id, dim: "EI|SN|TF|JP", left, right }
    const QUESTIONS = [
      // E–I (6)
      {id:'ei1', dim:'EI', left:'사람들과 이야기하며 생각이 정리된다', right:'혼자 정리한 뒤 말하는 편이다'},
      {id:'ei2', dim:'EI', left:'새로운 모임이 에너지를 준다', right:'새로운 모임은 에너지를 소모시킨다'},
      {id:'ei3', dim:'EI', left:'즉석에서 말하는 데 부담이 적다', right:'발언 전 정리 시간이 꼭 필요하다'},
      {id:'ei4', dim:'EI', left:'휴식은 주로 사람을 만나서 한다', right:'휴식은 주로 혼자 조용히 보낸다'},
      {id:'ei5', dim:'EI', left:'회의에서 중간중간 생각을 말해도 편하다', right:'완성된 생각만 말하는 편이 편하다'},
      {id:'ei6', dim:'EI', left:'하루를 마치고 대화/전화로 풀어낸다', right:'하루를 마치고 일기/메모로 정리한다'},
      // S–N (6)
      {id:'sn1', dim:'SN', left:'사실·세부·예시가 먼저 눈에 들어온다', right:'아이디어·큰 그림이 먼저 떠오른다'},
      {id:'sn2', dim:'SN', left:'현재의 현실과 제약부터 본다', right:'미래 가능성과 잠재력부터 본다'},
      {id:'sn3', dim:'SN', left:'경험과 순서를 따라가며 배우는 편', right:'직감과 연결로 도약하며 배우는 편'},
      {id:'sn4', dim:'SN', left:'검증된 지침·표준을 선호한다', right:'새로운 방식을 시도하길 즐긴다'},
      {id:'sn5', dim:'SN', left:'구체적 예시가 있어야 이해가 빠르다', right:'비유·개념이 더 이해를 돕는다'},
      {id:'sn6', dim:'SN', left:'실용성이 우선이다', right:'독창성이 우선이다'},
      // T–F (6)
      {id:'tf1', dim:'TF', left:'논리·원칙에 따라 결정을 내린다', right:'가치·관계의 영향을 우선 본다'},
      {id:'tf2', dim:'TF', left:'직설적 피드백이 편하다', right:'배려된 표현이 더 중요하다'},
      {id:'tf3', dim:'TF', left:'공정한 규칙을 중시한다', right:'관계의 조화를 중시한다'},
      {id:'tf4', dim:'TF', left:'진실을 말하는 것이 더 중요하다', right:'상대가 상처받지 않게 하는 게 더 중요하다'},
      {id:'tf5', dim:'TF', left:'데이터·지표로 설득한다', right:'사람·의미로 설득한다'},
      {id:'tf6', dim:'TF', left:'토론에서 반론은 성장의 일부다', right:'토론에서 공감이 더 중요하다'},
      // J–P (6)
      {id:'jp1', dim:'JP', left:'계획·마감이 있어야 마음이 편하다', right:'유연함·즉흥이 있어야 마음이 편하다'},
      {id:'jp2', dim:'JP', left:'체크리스트를 사랑한다', right:'상황 보며 그때그때 정한다'},
      {id:'jp3', dim:'JP', left:'미리 결정하고 진행한다', right:'선택지를 열어두고 진행한다'},
      {id:'jp4', dim:'JP', left:'정돈·정리가 되어야 일한다', right:'약간의 어수선함이 창의적이다'},
      {id:'jp5', dim:'JP', left:'마감은 일찍 시작하는 편', right:'데드라인이 와야 속도가 난다'},
      {id:'jp6', dim:'JP', left:'일정 변경이 불편하다', right:'일정 변경을 반갑게 수용한다'},
    ];

    // 유형 요약 (간단 버전)
    const TYPE_SUMMARY = {
      'INTJ':'전략가형 · 구조와 비전을 연결해 체계적으로 추진',
      'INTP':'사색가형 · 개념을 탐구하고 원리를 설계',
      'ENTJ':'지휘관형 · 목표 달성에 최적화를 설계하고 주도',
      'ENTP':'발명가형 · 가능성을 실험하고 토론으로 다듬음',
      'INFJ':'옹호자형 · 가치 기반 비전을 사람과 연결',
      'INFP':'중재자형 · 의미를 찾고 개인의 목소리를 존중',
      'ENFJ':'선도자형 · 사람을 성장시키는 촉진자',
      'ENFP':'활동가형 · 아이디어와 관계를 활기차게 확장',
      'ISTJ':'현실가형 · 신뢰 가능한 실행과 표준화',
      'ISFJ':'수호자형 · 세심한 배려와 안정 지향',
      'ESTJ':'경영자형 · 절차·성과 중심 운영',
      'ESFJ':'친선가형 · 협력과 공동체 관리',
      'ISTP':'장인형 · 문제를 손으로 해결하는 실용가',
      'ISFP':'모험가형 · 감수성과 자유로운 표현',
      'ESTP':'사업가형 · 실행력과 현장 감각',
      'ESFP':'연예인형 · 경험을 즐기며 분위기 메이커'
    };

    const TIPS = {
      'E': ['생각을 말하며 정리 시간 확보', '중간 피드백 루프 만들기'],
      'I': ['사전 자료 제공·답변 준비 시간', '회의 전 질문 2개 미리 작성'],
      'S': ['사실·예시·단계로 설계', '표준화·품질관리 강점 살리기'],
      'N': ['핵심 개념·그림·미래 시나리오', '아이디어에 근거 데이터 2개 붙이기'],
      'T': ['의사결정 기준·지표 명확화', '리스크·원리 정리 후 공유'],
      'F': ['이해관계자 영향 점검', '공감 문장으로 메시지 보강'],
      'J': ['마감 역산·체크리스트', '가변영역(±20%) 명시'],
      'P': ['스프린트·프로토타입', '라킨(고정) 항목 지정']
    };

    // ====== 상태 ======
    const STATE = {
      page: 1,
      pageSize: 6, // 한 페이지당 6문항
      answers: {}, // { id: 1..7 }
    };

    // ====== 유틸 ======
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function paginate(arr, size){
      const pages = [];
      for(let i=0;i<arr.length;i+=size) pages.push(arr.slice(i,i+size));
      return pages;
    }

    function updateProgress(){
      const answered = Object.keys(STATE.answers).length;
      const total = QUESTIONS.length;
      const w = Math.round((answered/total)*100);
      $('#progressBar').style.width = w + '%';
    }

    function renderPage(){
      const pages = paginate(QUESTIONS, STATE.pageSize);
      const totalPages = pages.length;
      $('#totalPages').textContent = totalPages;
      $('#currentPage').textContent = STATE.page;

      const pageItems = pages[STATE.page-1];
      const form = $('#quizForm');
      form.innerHTML = '';

      pageItems.forEach(q => {
        const v = STATE.answers[q.id] ?? 0;
        const field = document.createElement('fieldset');
        field.className = 'q';
        field.innerHTML = `
          <div class="meta">${q.dim} 문항</div>
          <div class="stem">${q.left} ↔ ${q.right}</div>
          <div class="scale" role="group" aria-label="7점 척도">
            <div class="anchors" aria-hidden="true">전적으로 왼쪽</div>
            <div class="options" data-qid="${q.id}">
              ${[1,2,3,4,5,6,7].map(n=>`
                <label class="pill" data-checked="${v===n}">
                  <input type="radio" name="${q.id}" value="${n}" ${v===n?'checked':''} aria-label="${n}">
                  ${n}
                </label>
              `).join('')}
            </div>
            <div class="anchors" aria-hidden="true">전적으로 오른쪽</div>
          </div>
        `;
        form.appendChild(field);
      });

      // 버튼 상태
      $('#prevBtn').disabled = STATE.page===1;
      $('#nextBtn').classList.toggle('hidden', STATE.page===totalPages);
      $('#submitBtn').classList.toggle('hidden', STATE.page!==totalPages);

      // 선택 핸들러 재바인딩
      $$('#quizForm .options').forEach(box=>{
        box.addEventListener('click', e=>{
          const label = e.target.closest('label.pill');
          if(!label) return;
          const input = label.querySelector('input');
          input.checked = true;
          const qid = box.dataset.qid;
          STATE.answers[qid] = Number(input.value);
          // 스타일 업데이트
          box.querySelectorAll('.pill').forEach(p=>p.dataset.checked='false');
          label.dataset.checked='true';
          updateProgress();
        })
      })

      updateProgress();
    }

    function ensurePageAnswered(){
      const start = (STATE.page-1)*STATE.pageSize;
      const end = start + STATE.pageSize;
      const ids = QUESTIONS.slice(start,end).map(q=>q.id);
      return ids.every(id=>STATE.answers[id]);
    }

    function computeResult(){
      // 각 축 점수 합산 (1..7, 왼쪽=저점, 오른쪽=고점)
      const dims = {EI:[], SN:[], TF:[], JP:[]};
      QUESTIONS.forEach(q=>{
        const v = STATE.answers[q.id];
        if(!v) return;
        dims[q.dim].push(v);
      });
      const sums = Object.fromEntries(Object.entries(dims).map(([k,arr])=>[k, arr.reduce((a,b)=>a+b,0)]));
      const countPerDim = QUESTIONS.length/4; // 6개
      const mid = 4 * countPerDim; // 중립 합계 (24)
      // 오른쪽(두번째 글자) 쪽으로 갈수록 합계가 큼
      const letter = {
        EI: sums.EI >= mid ? 'E2' : 'I1', // 임시 표시로 위치 기억
        SN: sums.SN >= mid ? 'N2' : 'S1',
        TF: sums.TF >= mid ? 'F2' : 'T1',
        JP: sums.JP >= mid ? 'P2' : 'J1',
      };
      const map = {E2:'E', I1:'I', N2:'N', S1:'S', F2:'F', T1:'T', P2:'P', J1:'J'};
      const code = map[letter.EI] + map[letter.SN] + map[letter.TF] + map[letter.JP];
      // 선호 강도(%) 계산: |합계-중립| / 최대편차 * 100
      const maxDev = (7-4) * countPerDim; // 한 축 최대 편차 (3*6=18)
      const pref = {
        EI: Math.round(Math.abs(sums.EI - mid) / maxDev * 100),
        SN: Math.round(Math.abs(sums.SN - mid) / maxDev * 100),
        TF: Math.round(Math.abs(sums.TF - mid) / maxDev * 100),
        JP: Math.round(Math.abs(sums.JP - mid) / maxDev * 100),
      };
      // 각 축의 진행바 비율 (왼쪽 기준 0~100, 오른쪽으로 갈수록 큼)
      const ratio = {
        EI: Math.round((sums.EI - (countPerDim*1)) / ((7-1)*countPerDim) * 100),
        SN: Math.round((sums.SN - (countPerDim*1)) / ((7-1)*countPerDim) * 100),
        TF: Math.round((sums.TF - (countPerDim*1)) / ((7-1)*countPerDim) * 100),
        JP: Math.round((sums.JP - (countPerDim*1)) / ((7-1)*countPerDim) * 100),
      };
      return {code, sums, pref, ratio};
    }

    function renderResult(){
      const {code, pref, ratio} = computeResult();
      // 코드 & 요약
      $('#typeCode').innerHTML = `${code} <small>${TYPE_SUMMARY[code] || ''}</small>`;
      $('#typeSummary').textContent = TYPE_SUMMARY[code] ? '설명: ' + TYPE_SUMMARY[code] : '설명 데이터가 준비되지 않았습니다.';

      // 바
      const bars = $('#bars');
      bars.innerHTML = '';
      const order = [
        {k:'EI', left:'I', right:'E'},
        {k:'SN', left:'S', right:'N'},
        {k:'TF', left:'T', right:'F'},
        {k:'JP', left:'J', right:'P'},
      ];
      order.forEach(({k,left,right})=>{
        const wrap = document.createElement('div');
        const label = document.createElement('div'); label.className='bar-label';
        label.innerHTML = `<div>${left}</div><div>${pref[k]}%</div><div>${right}</div>`;
        const bar = document.createElement('div'); bar.className='bar';
        const fill = document.createElement('div'); fill.style.width = ratio[k] + '%';
        bar.appendChild(fill);
        wrap.appendChild(label); wrap.appendChild(bar);
        bars.appendChild(wrap);
      });

      // 팁: 코드의 각 글자별로 묶어 제공
      const tips = $('#tips');
      tips.innerHTML = '';
      code.split('').forEach(ch => {
        const li = document.createElement('li');
        li.innerHTML = `<b>${ch}</b> · ${TIPS[ch].join(' · ')}`;
        tips.appendChild(li);
      });

      // 공유 링크(해시로 답안 인코딩)
      const payload = btoa(JSON.stringify(STATE.answers));
      const url = location.origin + location.pathname + '#r=' + payload;
      $('#shareBtn').onclick = async ()=>{
        try{ await navigator.clipboard.writeText(url); alert('링크가 복사되었습니다!'); }catch{ prompt('복사할 수 없어요. 아래 링크를 복사하세요:', url); }
      };
    }

    function show(sectionId){
      ['intro','quiz','result'].forEach(id=>$('#'+id).classList.add('hidden'));
      $('#'+sectionId).classList.remove('hidden');
      $('#'+sectionId).classList.add('fade-in');
    }

    // ====== 이벤트 ======
    $('#startBtn').addEventListener('click', ()=>{
      STATE.page = 1; STATE.answers = {}; updateProgress();
      show('quiz'); renderPage();
    });
    $('#skipToDemo').addEventListener('click', ()=>{
      // 데모: 약간 N, F, P에 치우친 임의 값
      STATE.answers = Object.fromEntries(QUESTIONS.map(q=>[q.id, (q.dim==='SN'||q.dim==='TF'||q.dim==='JP')? (5+Math.floor(Math.random()*3)) : (4+Math.floor(Math.random()*3)) ]));
      show('result'); renderResult();
      $('#progressBar').style.width = '100%';
    });

    $('#prevBtn').addEventListener('click', ()=>{
      if(STATE.page>1){ STATE.page--; renderPage(); }
    });
    $('#nextBtn').addEventListener('click', ()=>{
      if(!ensurePageAnswered()){ alert('이 페이지의 모든 문항에 응답해주세요.'); return; }
      const totalPages = Math.ceil(QUESTIONS.length/STATE.pageSize);
      if(STATE.page < totalPages){ STATE.page++; renderPage(); }
    });
    $('#submitBtn').addEventListener('click', ()=>{
      if(!ensurePageAnswered()){ alert('마지막 문항까지 응답해주세요.'); return; }
      show('result'); renderResult();
    });
    $('#restartBtn').addEventListener('click', ()=>{
      STATE.page=1; STATE.answers={}; show('intro'); updateProgress();
    });

    // 해시에서 공유 결과 로드
    window.addEventListener('load', ()=>{
      const m = location.hash.match(/#r=(.+)$/);
      if(m){
        try{
          const obj = JSON.parse(atob(m[1]));
          if(obj && typeof obj==='object'){
            STATE.answers = obj; show('result'); renderResult();
            $('#progressBar').style.width = '100%';
          }
        }catch(err){ console.warn('공유 링크 파싱 실패', err); }
      }
    });
  </script>
</body>
</html>
